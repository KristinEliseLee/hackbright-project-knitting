const s =Snap('#svg');

class Knit {
    constructor(){
    this.outline = `m 11.54812,9.8925219 c 0.246719,0.3879001 1.078215,0.5111701 1.446711,0.4863701 M 12.253614,5.2874319 c 0.693748,0 0.693748,0 0.693748,0 M 10.776596,0.84803187 c 0.03165,-0.14497 -0.02918,-0.51911 0.05778,-0.72619 M 7.8002003,6.2832319 c -0.622141,-0.67715 -1.436823,-2.36512 -1.275599,-6.26771003 m 4.2519887,0.61505 C 13.214953,4.0398219 12.129452,8.2350419 10.78039,11.949322 M 6.5022273,11.760162 C 6.7536253,6.4890919 9.5655053,2.6643819 10.843737,0.63057187 M 1.4563483,9.8925219 C 1.2096294,10.280422 0.37813231,10.403692 0.00963581,10.378892 m 0.7412179,-5.0914601 c -0.6937479,0 -0.6937479,0 -0.6937479,0 M 2.2278708,0.84803187 c -0.03164,-0.14497 0.029177,-0.51911 -0.057786,-0.72619 M 5.2042623,6.2832319 c 0.62214,-0.67715 1.436823,-2.36512 1.275599,-6.26771003 m -4.2519902,0.61505 C -0.21049169,4.0398219 0.87500921,8.2350419 2.2240811,11.949322 m 4.2781642,-0.18916 C 6.2508473,6.4890919 3.4389664,2.6643819 2.1607341,0.63057187`
    this.width = 12.9;
    this.height = 11.9;
    this.abbr = "K",
    this.colorPath = `m 4.3222169,0.0883667 c -1.8534564,0 -2.0029222,0.0024657 -1.9931601,0.02790527 0.021725,0.0566135 0.042457,0.25328355 0.042891,0.40669352 l 5.16e-4,0.15864665 0.344165,0.53433426 c 1.2307418,1.9116765 1.874509,3.0646584 2.445846,4.3800945 L 5.302001,5.9169514 5.3557447,5.8373697 C 5.8319704,5.1302144 6.1616237,3.9417402 6.2885041,2.4773681 6.3418854,1.8612668 6.36598,0.77801355 6.3370801,0.27646892 L 6.3262268,0.0883667 Z m 2.348177,0 -0.010335,0.47232258 c -0.012094,0.52686902 0.00862,1.32273262 0.047542,1.81642662 0.1169937,1.4839029 0.4182557,2.6176932 0.9048543,3.4034097 0.041251,0.066609 0.080511,0.1214398 0.086816,0.1214398 0.00631,0 0.04068,-0.069529 0.076481,-0.1545127 C 8.0057891,5.2014021 8.4204166,4.3522688 8.7570888,3.738273 9.1535738,3.0151959 9.5062835,2.4326035 10.213331,1.3332519 l 0.419096,-0.65163976 0.01033,-0.24236248 c 0.0056,-0.13321713 0.01569,-0.26624693 0.02274,-0.29610595 L 10.678419,0.0883667 H 8.6744057 Z M 0.07183024,5.43326 0.06097819,6.0389079 C 0.05518786,6.3721672 0.04657586,7.2842124 0.04185792,8.0651407 0.03713997,8.8460687 0.02920004,9.6518263 0.02377117,9.8562458 L 0.01343588,10.228316 h 0.12919107 c 0.42089459,0 0.93289695,-0.158714 1.12809655,-0.3498492 L 1.3518555,9.7988849 1.2764079,9.5332681 C 0.87877958,8.1264852 0.65074257,6.7518663 0.63045247,5.6430663 l -0.003617,-0.2005047 -0.27750243,-0.00465 z m 12.31139276,5.291e-4 -0.01137,0.313676 c -0.04168,1.1327654 -0.235485,2.2917004 -0.614433,3.6778117 l -0.102319,0.375171 0.09405,0.08785 c 0.103351,0.096199 0.27042,0.1833662 0.453719,0.2366782 0.121487,0.03533 0.341092,0.08063 0.44235,0.09147 0.03216,0.0034 0.121734,0.0078 0.198955,0.0093 l 0.140559,0.0026 -0.01085,-0.8397423 c -0.006,-0.4616662 -0.01563,-1.540029 -0.0217,-2.396753 L 12.94081,5.4337992 h -0.278536 z`,
    this.prevColorPath = `m 2.316569,11.924391 0.052873,-0.023 L 2.306409,11.72877 C 1.5621164,9.6904655 1.1291249,7.96146 0.97474229,6.4112089 0.93139272,5.975909 0.93120301,4.8240129 0.9744163,4.4317438 1.0873323,3.4067469 1.3381018,2.5369921 1.7618699,1.7005835 1.9263028,1.3760354 2.1616904,0.97394447 2.1872508,0.97394447 c 0.013135,0 0.5614213,0.84813743 0.9232869,1.42822153 1.1972353,1.9192148 2.019047,3.6625861 2.5455932,5.4001593 0.3630256,1.1979646 0.5978467,2.4712177 0.6768994,3.6702997 l 0.019823,0.300679 h 0.1471658 0.1471657 l 0.0083,-0.08352 c 0.00456,-0.04594 0.020331,-0.245136 0.035035,-0.442665 C 6.8483349,9.1272568 7.4926319,6.9102649 8.5886559,4.7157179 9.0978034,3.6962619 9.5616047,2.9049755 10.548966,1.3712547 l 0.26578,-0.41285043 0.03085,0.0453548 c 0.09001,0.1323363 0.30813,0.5118194 0.402116,0.6996048 1.043215,2.0843677 1.096705,4.5430585 0.170048,7.8163705 -0.16936,0.5982496 -0.486251,1.5717806 -0.716527,2.2012726 -0.03317,0.09067 -0.06031,0.170393 -0.06031,0.177155 0,0.0068 0.02443,0.02013 0.05429,0.02971 0.03799,0.01219 -1.2195256,0.01773 -4.1886144,0.01847 -3.6167297,9e-4 -4.2351007,-0.0024 -4.1900311,-0.02195 z`,
    this.color = color
    }
};

class Purl {
    constructor(color){
    this.outline = `m 2.1627455,11.962793 c -0.2177086,-0.94397 -0.3797,-1.27124 -0.5974085,-1.86605 M 5.1863263,6.2530434 c 0.8490512,1.71264 1.2237511,3.7435301 1.2480343,5.5191496 M 0.01316897,10.380263 C 2.1205661,10.186523 3.8569613,9.5378634 5.7788291,5.2862534 M 2.1646889,0.04417335 2.344803,0.79072335 M 0.69099302,5.5289234 C 1.3280434,-0.42420665 3.2753642,0.26723335 6.5077477,0.23830335 M 0.06044278,5.2495634 c 2.68670182,0.45121 4.98446762,0.0428 6.44270112,0.0367 m 4.3403991,6.6765396 c 0.217708,-0.94397 0.3797,-1.27124 0.597408,-1.86605 M 7.8199616,6.2530534 C 6.9709104,7.9656834 6.5962104,9.9965735 6.5719272,11.772203 M 12.99312,10.380273 C 10.885722,10.186533 9.1493265,9.5378734 7.2274588,5.2862634 M 10.8416,0.04418335 l -0.180114,0.74655 m 1.65381,4.73819005 C 11.678245,-0.42420665 9.7309238,0.26723335 6.4985401,0.23831335 M 12.945846,5.2495734 c -2.686703,0.45121 -4.9844685,0.0428 -6.4427021,0.0367`
    this.width = 12.9;
    this.height = 11.8;
    this.abbr = "P",
    this.colorPath = `M 6.4977946,0.01033529 2.31097,0.01291909 2.38125,0.3038574 2.45153,0.59479571 2.511475,0.55655511 C 2.6120297,0.49227096 2.8474728,0.37919268 2.9879313,0.32762856 3.3050794,0.21119961 3.664858,0.14019296 4.1423828,0.10025228 c 0.2073142,-0.01734 4.1445732,-0.02499434 4.5123861,-0.008785 0.7864356,0.03465788 1.3659561,0.17730008 1.8055741,0.44493408 0.04452,0.0271002 0.08437,0.0496094 0.08888,0.0496094 0.0095,0 0.147679,-0.56597163 0.140043,-0.5736084 C 10.686477,0.00960918 8.8004945,0.00870209 6.4977946,0.01033529 Z M 12.952698,5.4058716 c -0.0037,-0.00437 -0.395463,0.050915 -0.461988,0.065112 -0.01584,0.00338 -0.02687,0.013954 -0.02687,0.026872 0,0.018941 -0.01657,0.02382 -0.133326,0.035657 -0.167789,0.01701 -0.161747,0.016828 -0.161747,-0.0062 0,-0.016372 -0.0095,-0.017963 -0.06201,-0.011885 -0.146196,0.016925 -0.461042,0.043999 -0.74104,0.063562 -0.377331,0.026363 -1.8071933,0.029958 -2.226737,0.00568 C 8.461231,5.5454605 7.7095468,5.4965023 7.5530272,5.4813178 l -0.073897,-0.00723 0.05271,0.1131716 c 0.028837,0.062131 0.1175343,0.2426443 0.1968873,0.4015258 0.1220444,0.244361 0.1490697,0.2909361 0.1777667,0.3028238 0.043413,0.017984 0.049711,0.028789 0.03359,0.058911 -0.014896,0.027833 0.0373,0.1331553 0.243396,0.4914429 0.879769,1.5294342 1.7851086,2.4598304 2.8515048,2.9310872 0.490006,0.2165408 1.019274,0.3503399 1.712557,0.4325319 0.07471,0.0089 0.161681,0.01688 0.19327,0.01757 l 0.05736,10e-4 -0.0072,-0.2862876 c -0.0039,-0.1575395 -0.0132,-1.2404558 -0.02067,-2.4065714 -0.0075,-1.1661156 -0.01527,-2.1227581 -0.01757,-2.1254516 z m -12.89792098,0.00206 c -0.0054555,0.00546 -0.01929673,1.452895 -0.04289144,4.4152343 l -0.00361735,0.4082471 0.14779459,-0.0155 C 0.67882512,10.161217 1.1621865,10.065196 1.5373738,9.941512 2.0349534,9.7774796 2.5288983,9.5116474 2.9305705,9.1916868 3.5594062,8.6907737 4.1356533,7.9933608 4.6958374,7.0559 4.8677552,6.7681977 5.0738426,6.3989534 5.0730753,6.3799722 c -2.646e-4,-0.0066 -0.00384,-0.025884 -0.00827,-0.042375 -0.00699,-0.026072 -0.00246,-0.032447 0.034623,-0.050126 0.039813,-0.018986 0.055109,-0.045819 0.2309934,-0.4035931 0.1035915,-0.2107199 0.1881024,-0.3884189 0.1881024,-0.3953245 0,-0.00807 -0.022188,-0.010718 -0.062012,-0.00672 C 5.200439,5.5075666 4.0338742,5.5770976 3.55792,5.5950049 3.1454391,5.6105229 2.0062057,5.6033949 1.7032528,5.5831199 1.4919432,5.5689779 1.0033789,5.5274629 0.90330163,5.5154239 c -0.0526224,-0.00633 -0.0620117,-0.00455 -0.0620117,0.011885 0,0.023051 0.006051,0.023214 -0.16174723,0.0062 -0.11676065,-0.011838 -0.13384196,-0.016716 -0.13384196,-0.035658 0,-0.012914 -0.0105137,-0.02349 -0.0263549,-0.026872 -0.0815766,-0.017412 -0.45896835,-0.068649 -0.46457112,-0.063045 z`,
    this.prevColorPath = `M 6.0022176,0.39015707 C 5.075955,0.3940983 4.246622,0.40228848 4.1594359,0.40876045 3.1247302,0.48556801 2.4916592,0.79000815 2.0117635,1.4407389 1.5095969,2.1216686 1.1530179,3.2430378 0.93741048,4.8203775 c -0.0582112,0.4258612 -0.0563134,0.3807053 -0.01757,0.3886068 0.0766568,0.015634 0.43821172,0.042606 1.10845942,0.082682 0.038979,0.00233 0.4242635,0.00235 0.8562786,5.292e-4 0.8857361,-0.00374 0.9592172,-0.00674 2.6106932,-0.1183389 0.5445548,-0.036798 1.1600386,-0.049128 1.5115357,-0.029972 0.1396741,0.00761 0.5729441,0.034895 0.962732,0.060461 1.2755583,0.083665 1.5342846,0.09411 2.2799636,0.094051 0.507863,-3.79e-5 0.859295,-0.00985 1.216464,-0.03514 0.230844,-0.016343 0.556379,-0.045195 0.607198,-0.053744 l 0.03979,-0.00672 -0.0072,-0.086299 C 12.095547,4.9961231 12.045239,4.6424291 11.996684,4.348055 11.79208,3.1076188 11.493486,2.1941236 11.093896,1.5859497 10.967732,1.3939273 10.851051,1.2532833 10.690303,1.0996745 10.290142,0.71728276 9.7995485,0.51501442 9.0562947,0.42633055 8.7832429,0.39375042 7.8143565,0.38244631 6.0022176,0.39015707 Z M 7.7669677,6.7194863 c -0.00156,0.00159 -0.037154,0.08534 -0.079065,0.1860352 -0.4952634,1.1899024 -0.8109614,2.5443211 -0.9229412,3.9568645 -0.021418,0.270179 -0.042375,0.669221 -0.042375,0.81442 v 0.10232 H 6.5045124 6.285921 v -0.06563 C 6.2857755,11.590334 6.2622408,11.12842 6.2440631,10.891842 6.1430026,9.5764836 5.8547192,8.2744925 5.41569,7.147884 5.32292,6.9098233 5.2453317,6.7283649 5.2363729,6.7287883 5.2321105,6.7289931 5.1972156,6.7862796 5.1588582,6.8559121 5.0260419,7.0970213 4.7935657,7.4777057 4.6276244,7.7256266 3.8117533,8.9445596 2.9408165,9.7154872 1.9270141,10.117212 c -0.087702,0.03475 -0.1609797,0.06517 -0.1632975,0.06718 -0.00232,0.002 0.048642,0.146225 0.1136882,0.320394 0.137595,0.368429 0.2270164,0.638389 0.3033406,0.917257 0.052444,0.191617 0.1245402,0.482802 0.1245402,0.503328 0,0.0054 -0.02008,0.01524 -0.044442,0.0217 -0.029635,0.0079 1.3749674,0.01137 4.2436685,0.01137 2.8687013,0 4.2727879,-0.0035 4.2431519,-0.01137 -0.02525,-0.0067 -0.04444,-0.01924 -0.04444,-0.02894 0,-0.02223 0.09645,-0.406024 0.149344,-0.594796 0.06491,-0.231643 0.151168,-0.487982 0.27802,-0.825789 0.06436,-0.171402 0.115513,-0.313043 0.113688,-0.314709 -0.0018,-0.0017 -0.06186,-0.02516 -0.133325,-0.05271 C 10.955609,10.070248 10.661857,9.9307286 10.510986,9.8453936 10.363702,9.7620867 10.096247,9.5851294 9.9575317,9.4790076 9.4059757,9.0570501 8.8470469,8.434367 8.3586629,7.6972043 8.2098046,7.472519 7.9446733,7.035379 7.8331136,6.8316239 7.798454,6.7683207 7.7685288,6.7178985 7.7669677,6.7194863 Z`,
    this.color = color
    this.stitchBelow = null   
   }
};

letterToStitch = {
    'k': Knit, 'p': Purl
};

idToStitch={

}

const row1 = ['k', 'p', 'k', 'p', 'k', 'p', 'k'];
const row2 = ['p', 'k', 'p', 'k', 'p', 'k', 'p'];

function translateRows(rows){
    const translatedRows = []
    for (let row of rows){
        let translatedRow = []
        for(let stitch of row){
            let current = new letterToStitch[stitch]();
            translatedRow.push(current);
        }
        translatedRows.push(translatedRow);
    }
    return translatedRows
}
function loadStitch(stitch){
    let newID = _.uniqueId('stitch');
    let color = s.path(d=stitch.colorPath);
    color.attr({
            'fill': '#6db3db',
            strokeWidth:1
        });
    let prevColor = s.path(d=stitch.prevColorPath);
    prevColor.attr({
            'fill': '#48c4be',
            strokeWidth:1
        });
    let outline = s.path(d=stitch.outline);
    outline.attr({
        stroke:'black',
        strokeWidth:.5,
        'fill-opacity':0
        });
    let group = s.group(color, prevColor, outline)
    group.attr({
            id: newID
        });
    idToStitch[newID] = stitch;
        stitch.image = group;
        group.stitch = stitch;
        group.click(changeOnClick)

    return group
}

function loadRow(row, down){
    let side = 0;
    for(let stitch of row){
        let group = loadStitch(stitch)
        group.transform(`translate(${side},${down})`);
        side += stitch.width;
    }
}

function loadRows(rows){
    let moveDown = 0;
    for (let i= rows.length-1; i>=0; i -= 1){
        let row = rows[i]
        loadRow(row, moveDown);
        moveDown += row[1].height;
    }
}

function makeStitchGroups(row){
    const rowOfGroups = [];
    let currentGroup = [];
    for (let stitch in row){
        if (currentGroup.length === 0 || 
            currentGroup[currentGroup.length-1].abbr === stitch.abbr){
            currentGroup.push(stitch);
        }else{
            rowOfGroups.push(currentGroup);
            currentGroup = [];
        }
        rowOfGroups.push(currentGroup);
    }
    return rowOfGroups;
}

function changeStitchType(stitch, newType){
    let transform = stitch.image.attr('transform');
    stitch.image.remove();
    const newStitch = new newType();
    loadStitch(newStitch)
    newStitch.image.transform(transform);
}
function changeOnClick(evt){
    const currentID = evt.currentTarget.id;
    const currentStitch = idToStitch[currentID];
    let opposite = Purl;
    if( currentStitch.abbr === 'P'){
        opposite = Knit;
    }
    changeStitchType(currentStitch, opposite);
}

const color = {
    1: '#6db3db',
    2: '#48c4be'
}

const translatedRows = translateRows([row1, row1, row1, row1])
loadRows(translatedRows);
// changeStitchType(translatedRows[0][0], Purl);


